Ext.application({name:"PT",paths:{PT:"resources/app"},controllers:["NavController"],autoCreateViewport:true});String.prototype.insert=function(b,a){if(b>0){return this.substring(0,b)+a+this.substring(b,this.length)}else{return a+this}};Ext.define("PT.controller.NavController",{extend:"Ext.app.Controller",refs:[{ref:"navview",selector:"navview"},{ref:"mainContent",selector:"mainContent"}],init:function(){var a=this;a.control({"viewport > panel":{afterlayout:this.onPanelRendered}});a.control({navview:{tabchange:a.onNavTabchange}})},onPanelRendered:function(){},onLaunch:function(){},onSideBarSelectionChange:function(a,b){if(b.length){this.showView(b[0])}},onNavItemsStoreLoad:function(b,a){Ext.defer(function(){if(a.length){var c=a[0],d=this;d.getNavsidebar().getSelectionModel().select(c)}},500,this)},onNavTabchange:function(d,a,c,b){this.getNavItemsStore().load({params:{ref:a.key}});this.getNavsidebar().bindStore(this.getNavItemsStore())},showView:function(b){var a=this.getMainContent();if(a!=null){if(b.data.value!=""){a.removeAll();a.add(Ext.create(b.data.value))}else{alert("配置参数错误")}}},clickNodeChange:function(g,e,d){var f=e[0];if(!f){return}if(f.isLeaf()){var c=f.data.url;var b=f.data.view;var a=null;if(c&&c!==""){a={title:f.data.text,id:f.data.name,iconCls:"tabs",html:"加载失败!",autoLoad:{url:f.data.url,scripts:true},closable:true};this.openTab(a)}else{if(b&&b!=""){a={title:f.data.text,id:f.data.name,iconCls:"tabs",items:[Ext.create(f.data.view)],closable:true};this.openTab(a)}else{alert("导航树参数配置错误！")}}}else{f.expand()}},openTab:function(a,e){tabContent=this.getViewer();var d=(typeof a=="string"?a:e||a.id);var b=Ext.getCmp(d);if(b){tabContent.setActiveTab(b)}else{if(typeof a!="string"){a.id=d;var c=tabContent.add(a);tabContent.setActiveTab(c)}}}});Ext.define("PT.model.ImageModel",{extend:"Ext.data.Model",fields:["name","id","url","tooltip","thumb_url"]});Ext.define("PT.store.FrequencyType",{extend:"Ext.data.Store",fields:["value","name"],data:[{value:1,name:"每周"},{value:2,name:"每两周"},{value:3,name:"每月"},{value:4,name:"每季"}]});Ext.define("PT.store.RegionType",{extend:"Ext.data.Store",fields:["value","name"],data:[{value:"A",name:"黄浦区"},{value:"B",name:"卢湾区"},{value:"C",name:"徐汇区"},{value:"D",name:"长宁区"},{value:"E",name:"静安区"},{value:"F",name:"普陀区"},{value:"G",name:"闸北区"},{value:"H",name:"虹口区"},{value:"I",name:"杨浦区"},{value:"J",name:"宝山区"},{value:"K",name:"闵行区"},{value:"L",name:"嘉定区"},{value:"M",name:"浦东新区"},{value:"N",name:"松江区"},{value:"O",name:"金山区"},{value:"P",name:"青浦区"},{value:"Q",name:"奉贤区"},{value:"R",name:"崇明县"}]});Ext.define("PT.store.RoleType",{extend:"Ext.data.Store",fields:["value","name"],data:[{value:1,name:"管理员"},{value:2,name:"测试员"},{value:3,name:"操作员"}]});Ext.define("PT.store.TaskType",{extend:"Ext.data.Store",fields:["value","name"],data:[{value:"D",name:"定点CQT测试"}]});Ext.define("PT.store.ResultTypeStore",{extend:"Ext.data.Store",fields:["value2","value1","key"],data:[{value2:"正常",value1:"接通",key:"101"},{value2:"噪音",value1:"接通",key:"102"},{value2:"串话",value1:"接通",key:"103"},{value2:"回音",value1:"接通",key:"104"},{value2:"无话音",value1:"接通",key:"105"},{value2:"单通",value1:"接通",key:"106"},{value2:"掉话",value1:"接通",key:"107"},{value2:"信道忙",value1:"未接通",key:"201"},{value2:"无信号",value1:"未接通",key:"202"},{value2:"无声音中断",value1:"未接通",key:"203"},{value2:"拨通后立即中断",value1:"未接通",key:"204"}]});Ext.define("PT.view.MainContent",{extend:"Ext.panel.Panel",region:"center",margins:"5 5 5 0",id:"mainContent",alias:"widget.mainContent",cls:"empty",layout:"fit",bodyStyle:"background:#f1f1f1",html:"<br/><br/>&lt;这是个空页&gt;"});Ext.define("PT.view.NavView",{extend:"Ext.panel.Panel",requires:["Ext.data.*","Ext.util.*","Ext.view.View"],title:"操作管理",alias:"widget.navview",split:true,width:250,minWidth:200,maxWidth:400,collapsible:false,animCollapse:true,margins:"0 0 0 3",layout:"accordion",initComponent:function(){var a=this;Ext.applyIf(a,{items:[{title:"任务管理",id:"monitor_menu",cls:"images-view",frame:true,iconCls:"info"},{title:"统计分析",id:"report_menu",cls:"images-view",frame:true,iconCls:"report"},{title:"用户中心",id:"userCenter_menu",cls:"images-view",frame:true,iconCls:"user"}]});a.callParent(arguments);a.on("boxready",a.on_boxready)},on_boxready:function(f,e,b,d){Ext.define("ImageModel",{extend:"Ext.data.Model",fields:["name","id","url","tooltip","thumb_url"]});var c=Ext.create("Ext.data.Store",{model:"ImageModel",autoLoad:false,proxy:{type:"ajax",url:"resources/data/MonitorMenu.json",reader:{type:"json",root:"images"}}});c.load({scope:this,callback:function(j,i,k){var h=Ext.getCmp("monitor_menu");h.add(f.initDataView(c))}});var g=Ext.create("Ext.data.Store",{model:"ImageModel",autoLoad:false,proxy:{type:"ajax",url:"resources/data/ReportMenu.json",reader:{type:"json",root:"images"}}});g.load({scope:this,callback:function(i,h,k){var j=Ext.getCmp("report_menu");j.add(f.initDataView(g))}});var a=Ext.create("Ext.data.Store",{model:"ImageModel",autoLoad:false,proxy:{type:"ajax",url:"resources/data/UserMenu.json",reader:{type:"json",root:"images"}}});a.load({scope:this,callback:function(i,h,k){var j=Ext.getCmp("userCenter_menu");j.add(f.initDataView(a))}})},initDataView:function(b){var a=Ext.create("Ext.view.View",{store:b,tpl:['<tpl for=".">','<div class="thumb-wrap" id="{name}">','<div class="thumb"><img  src="{thumb_url}" title="{tooltip}"></div>','<span class="x-editable">{name}</span></div>',"</tpl>",'<div class="x-clear"></div>'],multiSelect:false,trackOver:true,overItemCls:"x-item-over",itemSelector:"div.thumb-wrap",emptyText:"没有数据显示...",listeners:{itemclick:function(e,c){if(c==null){return}var f=c.getData();var d=Ext.getCmp("mainContent");if(d!=null){if(f.url!=""){d.removeAll();d.add(Ext.create(f.url))}else{alert("配置参数错误")}}}}});return a}});Ext.define("PT.view.Viewport",{extend:"Ext.container.Viewport",requires:["PT.view.NavView","Ext.layout.container.Border"],layout:"border",items:[{region:"north",margins:"0 0 0 0",contentEl:"north",border:false,height:60,bodyStyle:""},{region:"west",xtype:"navview"},{region:"center",margins:"0 5 5 5",layout:"border",border:true,items:[Ext.create("PT.view.MainContent")]}]});Ext.define("PT.view.report.ResultPanel",{extend:"Ext.panel.Panel",ids:null,viewConfig:{stripeRows:true},initComponent:function(){var d=this;var b=Ext.create("Ext.form.Panel",{region:"north",fieldDefaults:{msgTarget:"side",labelAlign:"right",labelWidth:105},defaults:{anchor:"100%"},items:[{collapsible:true,collapsed:false,bodyStyle:"padding:5px",title:"检索条件",defaultType:"textfield",layout:"anchor",defaults:{anchor:"50%"},items:[{fieldLabel:'<span style="color: #f00">*</span>开始时间',xtype:"fieldcontainer",anchor:"100%",layout:"hbox",items:[{xtype:"datefield",name:"txt_begin_date",format:"Y-m-d",value:new Date(),allowBlank:false},{xtype:"timefield",name:"txt_begin_time",format:"H:i:s",value:"00:00:00",allowBlank:false}]},{fieldLabel:'<span style="color: #f00">*</span>结束时间',xtype:"fieldcontainer",anchor:"100%",layout:"hbox",items:[{xtype:"datefield",name:"txt_end_date",format:"Y-m-d",value:new Date(),allowBlank:false},{xtype:"timefield",name:"txt_end_time",format:"H:i:s",value:"23:59:59",allowBlank:false}]},{xtype:"container",layout:"column",anchor:"0",items:[{xtype:"container",columnWidth:0.3,items:[{xtype:"textfield",fieldLabel:"任务",maxLength:11,name:"txt_phone"}]}]}],buttons:[{text:"检索",handler:function(){a()}},{text:"清空",handler:function(){var f=this.up("form").getForm();f.reset();a()}}]}]});var e=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},"fileName","index","beginDateTime","endDateTime","testResult","pointIndex","lac","rxlvl","cqt","callResult"],proxy:{type:"ajax",url:"testResult",reader:{type:"json",root:"rows"}}});var a=function(){var j=b.getForm();var f=j.findField("txt_phone").getValue();var h=j.findField("txt_begin_date").value;var k=Ext.Date.format(h,"Ymd");h=j.findField("txt_begin_time").getValue();var g=Ext.Date.format(h,"His");h=j.findField("txt_end_date").getValue();var l=Ext.Date.format(h,"Ymd");h=j.findField("txt_end_time").getValue();var i=Ext.Date.format(h,"His");e.on("beforeload",function(m,n){var o={MobileNum:f,TestBeginTime:k+g,TestEndTime:l+i};Ext.apply(m.proxy.extraParams,o)});e.load({params:{start:0,limit:25}})};var c='<img src="resources/images/icons/fam/accept.png"  border="0">';Ext.applyIf(d,{layout:"border",items:[b,{xtype:"gridpanel",region:"center",store:e,columns:[{header:"点位序号",dataIndex:"pointIndex"},{header:"LAC-CI",dataIndex:"lac"},{header:"RxLvl",dataIndex:"rxlvl"},{header:"CQT质量等级",dataIndex:"cqt",hidden:false},{header:"测试结果",dataIndex:"testResult",renderer:function(f){if(f=="00"){return"成功"}else{return"失败"}}},{text:"接通状态",columns:[{text:"正常",width:75,align:"center",renderer:function(f){if(f=="101"){return c}return""},dataIndex:"callResult"},{text:"噪音",width:75,align:"center",renderer:function(f){if(f=="102"){return c}return""},dataIndex:"callResult"},{text:"串话",width:75,align:"center",renderer:function(f){if(f=="103"){return c}return""},dataIndex:"callResult"},{text:"无话音",width:75,align:"center",renderer:function(f){if(f=="104"){return c}return""},dataIndex:"callResult"},{text:"单通",width:75,align:"center",renderer:function(f){if(f=="105"){return c}return""},dataIndex:"callResult"},{text:"掉话",width:75,align:"center",renderer:function(f){if(f=="106"){return c}return""},dataIndex:"callResult"},{text:"单通",width:75,align:"center",renderer:function(f){if(f=="107"){return c}return""},dataIndex:"callResult"}]},{text:"未接通",columns:[{text:"信道忙",width:75,align:"center",renderer:function(f){if(f=="201"){return c}return""},dataIndex:"callResult"},{text:"无信号",width:75,align:"center",renderer:function(f){if(f=="202"){return c}return""},dataIndex:"callResult"},{text:"无声音中断",width:75,align:"center",renderer:function(f){if(f=="203"){return c}return""},dataIndex:"callResult"},{text:"拨通后立即中断",width:75,align:"center",renderer:function(f){if(f=="204"){return c}return""},dataIndex:"callResult"}]},{header:"测试序号",dataIndex:"index",hidden:true},{header:"呼叫结果 ",dataIndex:"callResult",hidden:true},{header:"测试开始时间",dataIndex:"beginDateTime",flex:1,renderer:function(f){if(f.length==14){return f.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return f}},{header:"测试结束时间",dataIndex:"endDateTime",flex:1,renderer:function(f){if(f.length==14){return f.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return f}}],dockedItems:[{xtype:"pagingtoolbar",store:e,dock:"bottom",displayInfo:true}]}]});d.callParent(arguments)}});Ext.define("PT.view.report.ResultV2Panel",{extend:"Ext.panel.Panel",ids:null,curRb:"A",viewConfig:{stripeRows:true},initComponent:function(){var c=this;var d=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},"fileName","beginDateTime","endDateTime","phone",{name:"mtype",type:"int"},"key1","key2","key3","key4","key5","key6","key7","key8","key9","key10","createDt"],proxy:{type:"ajax",url:"testV2Result",reader:{type:"json",root:"rows"}}});var b=Ext.create("Ext.form.Panel",{region:"north",fieldDefaults:{msgTarget:"side",labelAlign:"right",labelWidth:105},defaults:{anchor:"100%"},items:[{collapsible:true,collapsed:false,bodyStyle:"padding:5px",title:"检索条件",defaultType:"textfield",layout:"anchor",defaults:{anchor:"50%"},items:[{fieldLabel:'<span style="color: #f00">*</span>开始时间',xtype:"fieldcontainer",anchor:"100%",layout:"hbox",items:[{xtype:"datefield",name:"txt_begin_date",format:"Y-m-d",value:new Date(),allowBlank:false},{xtype:"timefield",name:"txt_begin_time",format:"H:i:s",value:"00:00:00",allowBlank:false}]},{fieldLabel:'<span style="color: #f00">*</span>结束时间',xtype:"fieldcontainer",anchor:"100%",layout:"hbox",items:[{xtype:"datefield",name:"txt_end_date",format:"Y-m-d",value:new Date(),allowBlank:false},{xtype:"timefield",name:"txt_end_time",format:"H:i:s",value:"23:59:59",allowBlank:false}]},{xtype:"radiogroup",columns:4,vertical:false,items:[{boxLabel:"定点场强测试",name:"rb",inputValue:"A",checked:true},{boxLabel:"业务拨测",name:"rb",inputValue:"B"},{boxLabel:"室内外切换测试",name:"rb",inputValue:"C"},{boxLabel:"CQT测试",name:"rb",inputValue:"D"}],listeners:{change:function(h,i,e,g){var f=i.rb;c.curRb=f;c.openGrid(f,d);a()}}},{xtype:"container",layout:"column",anchor:"0",items:[{xtype:"container",columnWidth:0.3,items:[{xtype:"textfield",fieldLabel:"手机号",maxLength:11,name:"txt_phone"}]}]}],buttons:[{text:"检索",handler:function(){a()}},{text:"清空",handler:function(){var e=this.up("form").getForm();e.reset();a()}}]}]});var a=function(){var i=b.getForm();var g=i.findField("txt_phone").getValue();var f=i.findField("txt_begin_date").value;var j=Ext.Date.format(f,"Ymd");f=i.findField("txt_begin_time").getValue();var e=Ext.Date.format(f,"His");f=i.findField("txt_end_date").getValue();var k=Ext.Date.format(f,"Ymd");f=i.findField("txt_end_time").getValue();var h=Ext.Date.format(f,"His");d.on("beforeload",function(l,m){var n={phone:g,mtype:c.curRb,TestBeginTime:j+e,TestEndTime:k+h};Ext.apply(l.proxy.extraParams,n)});d.load({params:{start:0,limit:25,index:1}})};Ext.applyIf(c,{layout:"border",items:[b,{id:"grid_manager",layout:"border",region:"center"}]});c.callParent(arguments);c.openGrid("A",d);a()},openGrid:function(a,d){var c=Ext.getCmp("grid_manager");if(c!=null){var b=Ext.create("PT.view.report.Test"+a+"GridPanel",{store:d});c.removeAll();c.add(b)}}});Ext.define("PT.view.report.TestAGridPanel",{extend:"Ext.grid.Panel",store:null,initComponent:function(){var a=this;Ext.applyIf(a,{store:a.store,region:"center",columns:[{text:"起始时间 ",dataIndex:"beginDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"结束时间 ",dataIndex:"endDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"手机号 ",dataIndex:"phone"},{text:"测试结果 ",dataIndex:"key1",renderer:testResult},{text:"点位序号 ",dataIndex:"key2"},{text:"LAC-CI",dataIndex:"key3",flex:1},{text:"RxLvl均值",dataIndex:"key4"}],dockedItems:[{xtype:"pagingtoolbar",store:a.store,dock:"bottom",displayInfo:true}]});a.callParent(arguments)}});Ext.define("PT.view.report.TestBGridPanel",{extend:"Ext.grid.Panel",store:null,initComponent:function(){var a=this;Ext.applyIf(a,{store:a.store,region:"center",columns:[{text:"起始时间 ",dataIndex:"beginDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"结束时间 ",dataIndex:"endDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"手机号 ",dataIndex:"phone"},{text:"业务拨测种类代码 ",dataIndex:"key1"},{text:"测试结果  ",dataIndex:"key2",renderer:testResult},{text:"测试值",dataIndex:"key3",flex:1}],dockedItems:[{xtype:"pagingtoolbar",store:a.store,dock:"bottom",displayInfo:true}]});a.callParent(arguments)}});Ext.define("PT.view.report.TestCGridPanel",{extend:"Ext.grid.Panel",store:null,initComponent:function(){var a=this;Ext.applyIf(a,{store:a.store,region:"center",columns:[{text:"起始时间 ",dataIndex:"beginDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"结束时间 ",dataIndex:"endDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"手机号 ",dataIndex:"phone"},{text:"测试结果 ",dataIndex:"key1",renderer:testResult},{text:"点位序号（室内） ",dataIndex:"key2"},{text:"LAC-CI（室内）",dataIndex:"key3",flex:1},{text:"RxLvl均值（室内）",dataIndex:"key4"},{text:"点位序号（室外）",dataIndex:"key5"},{text:"LAC-CI（室外）",dataIndex:"key6"},{text:"RxLvl均值（室外）",dataIndex:"key7"},{text:"CQT质量等级",dataIndex:"key8"},{text:"呼叫结果",dataIndex:"key9",renderer:function(d){var c=Ext.create("PT.store.ResultTypeStore");var b=c.findRecord("key",d);if(b!=null){return b.data.value1+" "+b.data.value2}return d}}],dockedItems:[{xtype:"pagingtoolbar",store:a.store,dock:"bottom",displayInfo:true}]});a.callParent(arguments)}});Ext.define("PT.view.report.TestDGridPanel",{extend:"Ext.grid.Panel",store:null,initComponent:function(){var a=this;Ext.applyIf(a,{store:a.store,region:"center",columns:[{text:"起始时间 ",dataIndex:"beginDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"结束时间 ",dataIndex:"endDateTime",flex:1,renderer:function(b){if(b.length==14){return b.insert(12,":").insert(10,":").insert(8," ").insert(6,"-").insert(4,"-")}return b}},{text:"手机号 ",dataIndex:"phone"},{text:"测试结果 ",dataIndex:"key1",renderer:testResult},{text:"点位序号 ",dataIndex:"key2"},{text:"LAC-CI",dataIndex:"key3",flex:1},{text:"RxLvl均值",dataIndex:"key4"},{text:"CQT质量等级",dataIndex:"key5"},{text:"呼叫结果",dataIndex:"key6",renderer:function(d){var c=Ext.create("PT.store.ResultTypeStore");var b=c.findRecord("key",d);if(b!=null){return b.data.value1+" "+b.data.value2}return d}}],dockedItems:[{xtype:"pagingtoolbar",store:a.store,dock:"bottom",displayInfo:true}]});a.callParent(arguments)}});Ext.define("PT.view.sys.UsersPanel",{extend:"Ext.panel.Panel",ids:null,viewConfig:{stripeRows:true},initComponent:function(){var b=this;var c=Ext.create("Ext.data.Store",{fields:["userName","passWord","remarks","createIP",{name:"createDT",type:"date"},{name:"role",type:"int"}],proxy:{type:"ajax",url:"users",reader:{type:"json",root:"rows"}}});var a=function(d){c.on("beforeload",function(e,f){var g={key:d};Ext.apply(e.proxy.extraParams,g)});c.load()};Ext.applyIf(b,{layout:"border",items:[{xtype:"gridpanel",region:"center",title:"用户管理",store:c,selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"SIMPLE"}),columns:[{header:"用户名",dataIndex:"userName"},{header:"角色",dataIndex:"role",flex:1,hidden:false,renderer:function(e){var d=Ext.create("PT.store.RoleType").findRecord("value",e);if(d!=null){return d.data.name}return e}},{header:"备注",dataIndex:"remarks",flex:1},{header:"创建时间",dataIndex:"createDT"},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/information.png",tooltip:"查看",handler:function(e,g,d){var f=e.getStore().getAt(g);Ext.create("PT.view.window.EditUserWindow",{rec:f,listeners:{beforedestroy:function(){a("")}}}).show()}}]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"添加",tooltip:"添加用户",iconCls:"add",handler:function(){Ext.create("PT.view.window.EditUserWindow",{listeners:{beforedestroy:function(){a("")}}}).show()}},{text:"删除",tooltip:"删除用户",iconCls:"del",handler:function(){var d=b.child("grid").getSelectionModel().getSelection();if(d.length==0){alert("请选择要删除用户！");return}var e="";for(var f=0;f<d.length;f++){e+=d[f].data.userName+";"}Ext.Msg.show({title:"信息",msg:"确定要删除选中用户吗？",buttons:Ext.Msg.YESNO,fn:function(h,i,g){if(h=="yes"){Ext.Ajax.request({url:"deleteUser",params:{users:e},success:function(k){var l=k.responseText;var j=Ext.JSON.decode(l);if(j.success){a("")}else{alert(j.msg)}}})}},icon:Ext.window.MessageBox.QUESTION})}},"-",{xtype:"textfield",name:"txt_search_key",emptyText:"请输入要查询用户"},{text:"检索",tooltip:"检索查询用户",iconCls:"search",handler:function(){var d=this.up("toolbar").child("textfield").getValue();a(d)}}]}]}]});b.callParent(arguments);a("")}});Ext.define("PT.view.task.ManagerPanel",{extend:"Ext.panel.Panel",ids:null,searchKey:"",curAddress:"",viewConfig:{stripeRows:true},initComponent:function(){var d=this;var e=Ext.create("Ext.data.Store",{fields:[{name:"bid",type:"int"},"bcode","bname","blocation",{name:"btype",type:"int"},{name:"frequency",type:"int"},"acode","remarks","longitude","latitude"],proxy:{type:"ajax",url:"getBuildings",reader:{type:"json",root:"rows"}}});var a=function(){e.on("beforeload",function(f,g){var h={bname:d.searchKey,acode:d.curAddress};Ext.apply(f.proxy.extraParams,h)});e.load({params:{start:0,limit:25,index:1}})};var b=Ext.create("Ext.data.TreeStore",{root:{expanded:true,children:[{text:"上海市",expanded:true,children:[{value:"A",text:"黄浦区",leaf:true},{value:"B",text:"卢湾区",leaf:true},{value:"C",text:"徐汇区",leaf:true},{value:"D",text:"长宁区",leaf:true},{value:"E",text:"静安区",leaf:true},{value:"F",text:"普陀区",leaf:true},{value:"G",text:"闸北区",leaf:true},{value:"H",text:"虹口区",leaf:true},{value:"I",text:"杨浦区",leaf:true},{value:"J",text:"宝山区",leaf:true},{value:"K",text:"闵行区",leaf:true},{value:"L",text:"嘉定区",leaf:true},{value:"M",text:"浦东新区",leaf:true},{value:"N",text:"松江区",leaf:true},{value:"O",text:"金山区",leaf:true},{value:"P",text:"青浦区",leaf:true},{value:"Q",text:"奉贤区",leaf:true},{value:"R",text:"崇明县",leaf:true}]}]}});var c=Ext.create("Ext.tree.Panel",{title:"区域信息",width:200,store:b,region:"west",rootVisible:false,listeners:{selectionchange:function(g,h,f){if(h!=null&&h.length>0){if(h[0].raw.value){d.curAddress=h[0].raw.value;a()}else{d.curAddress="";a()}}}}});Ext.applyIf(d,{layout:"border",items:[c,{xtype:"gridpanel",region:"center",title:"任务管理",store:e,columns:[{header:"行政区域",dataIndex:"acode",renderer:function(g){var f=Ext.create("PT.store.RegionType").findRecord("value",g);if(f!=null){return f.data.name}return g}},{header:"楼宇名称",dataIndex:"bname",flex:1},{header:"类型",dataIndex:"btype",flex:1,renderer:function(f){if(f==0){return"普通楼宇"}else{if(f==1){return"VIP"}else{if(f==2){return"WIP"}}}return f}},{xtype:"actioncolumn",header:"人员及任务安排",items:[{icon:"resources/images/icons/fam/edit.gif",tooltip:"人员安排",handler:function(g,i,f){var h=g.getStore().getAt(i);Ext.create("PT.view.window.TaskUserSelWindow",{rec:h,bid:h.data.bid}).show()}},{icon:"resources/images/icons/fam/arrow_down.png",tooltip:"任务安排",handler:function(g,i,f){var h=g.getStore().getAt(i);Ext.create("PT.view.window.TaskListWindow",{rec:h}).show()}}]}],dockedItems:[{xtype:"pagingtoolbar",store:e,dock:"bottom",displayInfo:true}]}]});d.callParent(arguments);e.load()}});Ext.define("PT.view.task.BuildingPanel",{extend:"Ext.panel.Panel",ids:null,searchKey:"",curAddress:"",viewConfig:{stripeRows:true},initComponent:function(){var d=this;var e=Ext.create("Ext.data.Store",{fields:[{name:"bid",type:"int"},"bcode","bname","blocation",{name:"btype",type:"int"},{name:"frequency",type:"int"},"acode","remarks","longitude","latitude"],proxy:{type:"ajax",url:"getBuildings",reader:{type:"json",root:"rows"}}});var a=function(){e.on("beforeload",function(f,g){var h={bname:d.searchKey,acode:d.curAddress};Ext.apply(f.proxy.extraParams,h)});e.load({params:{start:0,limit:25,index:1}})};var b=Ext.create("Ext.data.TreeStore",{root:{expanded:true,children:[{text:"上海市",expanded:true,children:[{value:"A",text:"黄浦区",leaf:true},{value:"B",text:"卢湾区",leaf:true},{value:"C",text:"徐汇区",leaf:true},{value:"D",text:"长宁区",leaf:true},{value:"E",text:"静安区",leaf:true},{value:"F",text:"普陀区",leaf:true},{value:"G",text:"闸北区",leaf:true},{value:"H",text:"虹口区",leaf:true},{value:"I",text:"杨浦区",leaf:true},{value:"J",text:"宝山区",leaf:true},{value:"K",text:"闵行区",leaf:true},{value:"L",text:"嘉定区",leaf:true},{value:"M",text:"浦东新区",leaf:true},{value:"N",text:"松江区",leaf:true},{value:"O",text:"金山区",leaf:true},{value:"P",text:"青浦区",leaf:true},{value:"Q",text:"奉贤区",leaf:true},{value:"R",text:"崇明县",leaf:true}]}]}});var c=Ext.create("Ext.tree.Panel",{title:"区域信息",width:200,store:b,region:"west",rootVisible:false,listeners:{selectionchange:function(g,h,f){if(h!=null&&h.length>0){if(h[0].raw.value){d.curAddress=h[0].raw.value;a()}else{d.curAddress="";a()}}}}});Ext.applyIf(d,{layout:"border",items:[c,{xtype:"gridpanel",region:"center",title:"楼宇管理",selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"SIMPLE"}),store:e,columns:[{header:"楼宇代码",dataIndex:"bcode",flex:1},{header:"楼宇名称",dataIndex:"bname"},{header:"地址",dataIndex:"blocation",flex:1},{header:"类型",dataIndex:"btype",flex:1,renderer:function(f){if(f==0){return"普通楼宇"}else{if(f==1){return"VIP"}else{if(f==2){return"WIP"}}}return f}},{header:"行政区",dataIndex:"acode",flex:1,renderer:function(g){var f=Ext.create("PT.store.RegionType").findRecord("value",g);if(f!=null){return f.data.name}return g}},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/edit.gif",tooltip:"编辑",handler:function(g,i,f){var h=g.getStore().getAt(i);Ext.create("PT.view.window.EditBuildingWindow",{rec:h,listeners:{beforedestroy:function(){e.load({params:{taskType:0}})}}}).show()}},{icon:"resources/images/icons/fam/information.png",tooltip:"点位查看",handler:function(g,i,f){var h=g.getStore().getAt(i);Ext.create("PT.view.window.PostionListWindow",{rec:h}).show()}}]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"添加",tooltip:"添加楼宇",iconCls:"add",handler:function(){Ext.create("PT.view.window.EditBuildingWindow",{listeners:{beforedestroy:function(){e.load({params:{taskType:0}})}}}).show()}},{text:"删除",tooltip:"删除楼宇",iconCls:"del",handler:function(){var f=d.child("grid").getSelectionModel().getSelection();if(f.length==0){alert("请选择要删除楼宇！");return}var g="";for(var h=0;h<f.length;h++){g+=f[h].data.bid+";"}Ext.Msg.show({title:"信息",msg:"确定要删除选中楼宇吗？",buttons:Ext.Msg.YESNO,fn:function(j,k,i){if(j=="yes"){Ext.Ajax.request({url:"delBuilding",params:{bidStr:g},success:function(n){var o=n.responseText;var l=Ext.JSON.decode(o);if(l.success){e.load({params:{key:""}})}else{alert(l.msg)}}})}},icon:Ext.window.MessageBox.QUESTION})}},"-",{xtype:"textfield",name:"search_key"},{text:"检索",tooltip:"检索关键字",iconCls:"search",handler:function(){}}]},{xtype:"pagingtoolbar",store:e,dock:"bottom",displayInfo:true}]}]});d.callParent(arguments);e.load({params:{taskType:0}})}});Ext.define("PT.view.task.PostionPanel",{extend:"Ext.panel.Panel",ids:null,viewConfig:{stripeRows:true},initComponent:function(){var c=this;var d=Ext.create("Ext.data.Store",{fields:[{name:"bid",type:"int"},"bcode","bname","blocation",{name:"btype",type:"int"},{name:"frequency",type:"int"},"acode","remarks","longitude","latitude"],proxy:{type:"ajax",url:"getBuildings",reader:{type:"json",root:"rows"}}});var a=Ext.create("Ext.data.TreeStore",{root:{expanded:true,children:[{value:"A",text:"黄浦区",leaf:true},{value:"B",text:"卢湾区",leaf:true},{value:"C",text:"徐汇区",leaf:true},{value:"D",text:"长宁区",leaf:true},{value:"E",text:"静安区",leaf:true},{value:"F",text:"普陀区",leaf:true},{value:"G",text:"闸北区",leaf:true},{value:"H",text:"虹口区",leaf:true},{value:"I",text:"杨浦区",leaf:true},{value:"J",text:"宝山区",leaf:true},{value:"K",text:"闵行区",leaf:true},{value:"L",text:"嘉定区",leaf:true},{value:"M",text:"浦东新区",leaf:true},{value:"N",text:"松江区",leaf:true},{value:"O",text:"金山区",leaf:true},{value:"P",text:"青浦区",leaf:true},{value:"Q",text:"奉贤区",leaf:true},{value:"R",text:"崇明县",leaf:true}]}});var b=Ext.create("Ext.tree.Panel",{title:"区域信息",width:200,store:a,region:"west",rootVisible:true});Ext.applyIf(c,{layout:"border",items:[b,{xtype:"gridpanel",region:"center",title:"楼宇管理",store:d,columns:[{header:"楼宇代码",dataIndex:"bcode",flex:1},{header:"楼宇名称",dataIndex:"bname",renderer:function(e){return e}},{header:"地址",dataIndex:"blocation",flex:1},{header:"类型",dataIndex:"btype",flex:1,renderer:function(e){if(e==0){return"普通楼宇"}else{if(e==1){return"VIP"}else{if(e==2){return"WIP"}}}return e}},{header:"行政区",dataIndex:"acode",flex:1,renderer:function(f){var e=Ext.create("PT.store.RegionType").findRecord("value",f);if(e!=null){return e.data.name}return f}},{header:"点位数量(个)",dataIndex:"callTime",flex:1},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/image_add.png",tooltip:"添加点位",handler:function(f,h,e){var g=f.getStore().getAt(h);Ext.create("PT.view.window.EditPostionWindow",{bid:g.data.bid,listeners:{beforedestroy:function(){}}}).show()}},{icon:"resources/images/icons/fam/information.png",tooltip:"查看",handler:function(f,h,e){var g=f.getStore().getAt(h);Ext.create("PT.view.window.ViewBuildingWindow",{rec:g,listeners:{beforedestroy:function(){}}}).show()}}]}],dockedItems:[{xtype:"pagingtoolbar",store:d,dock:"bottom",displayInfo:true}]}]});c.callParent(arguments);d.load({params:{taskType:0}})}});Ext.define("PT.view.task.TestUserPanel",{extend:"Ext.panel.Panel",ids:null,viewConfig:{stripeRows:true},initComponent:function(){var a=this;var b=Ext.create("Ext.data.Store",{fields:["mobileId","ecode","ename",{name:"status",type:"int"}],proxy:{type:"ajax",url:"getMobileList",reader:{type:"json",root:"rows"}}});Ext.applyIf(a,{layout:"border",items:[{xtype:"gridpanel",region:"center",title:"巡检人员管理",selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"SIMPLE"}),store:b,columns:[{header:"手机号码",dataIndex:"mobileId",flex:1},{header:"员工编码",dataIndex:"ecode"},{header:"姓名",dataIndex:"ename",flex:1},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/edit.gif",tooltip:"查看",handler:function(d,f,c){var e=d.getStore().getAt(f);Ext.create("PT.view.window.EditTestUserWindow",{rec:e,listeners:{beforedestroy:function(){b.load({params:{taskType:0}})}}}).show()}}]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"添加",tooltip:"添加巡检人员",iconCls:"add",handler:function(){Ext.create("PT.view.window.EditTestUserWindow",{listeners:{beforedestroy:function(){b.load({params:{taskType:0}})}}}).show()}},{text:"删除",tooltip:"删除巡检人员",iconCls:"del",handler:function(){var c=a.child("grid").getSelectionModel().getSelection();if(c.length==0){alert("请选择要删除巡检人员！");return}var d="";for(var e=0;e<c.length;e++){d+=c[e].data.mobileId+";"}Ext.Msg.show({title:"信息",msg:"确定要删除选中巡检人员吗？",buttons:Ext.Msg.YESNO,fn:function(g,h,f){if(g=="yes"){Ext.Ajax.request({url:"delMobile",params:{mobileStr:d},success:function(j){var k=j.responseText;var i=Ext.JSON.decode(k);if(i.success){b.load({params:{key:""}})}else{alert(i.msg)}}})}},icon:Ext.window.MessageBox.QUESTION})}}]},{xtype:"pagingtoolbar",store:b,dock:"bottom",displayInfo:true}]}]});a.callParent(arguments);b.load({params:{taskType:0}})}});Ext.define("PT.view.window.EditBuildingWindow",{extend:"Ext.window.Window",width:600,height:400,modal:true,rec:null,title:"楼宇编辑",initComponent:function(){var a=this;var b=Ext.create("Ext.form.Panel",{region:"center",bodyPadding:5,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaults:{anchor:"95%"},defaultType:"textfield",items:[{fieldLabel:"楼宇代码",name:"bcode",anchor:"50%",allowBlank:false},{fieldLabel:"名称",name:"bname",maxLength:20,allowBlank:false,anchor:"90%"},{fieldLabel:"行政区",name:"acode",allowBlank:false,xtype:"combobox",store:Ext.create("PT.store.RegionType"),queryMode:"local",displayField:"name",valueField:"value",anchor:"50%"},{fieldLabel:"地址",name:"blocation",maxLength:50,allowBlank:false,anchor:"90%"},{fieldLabel:"楼宇类型",xtype:"fieldcontainer",defaultType:"radiofield",defaults:{flex:1},layout:"hbox",anchor:"100%",items:[{boxLabel:"普通楼宇",name:"btype",inputValue:"0",checked:true,id:"btype_radio1"},{boxLabel:"VIP",name:"btype",inputValue:"1",id:"btype_radio2"},{boxLabel:"WIP",name:"btype",inputValue:"2",id:"btype_radio3"}]},{fieldLabel:"巡检频率",name:"frequency",allowBlank:false,xtype:"combobox",store:Ext.create("PT.store.FrequencyType"),queryMode:"local",value:1,hidden:true,displayField:"name",valueField:"value",anchor:"50%"},{xtype:"textfield",fieldLabel:"经度",hidden:true,name:"longitude",anchor:"50%"},{fieldLabel:"纬度",xtype:"textfield",hidden:true,name:"latitude",anchor:"50%"},{fieldLabel:"备注",xtype:"textfield",name:"remarks",maxLength:255,allowBlank:true,anchor:"90%"},{xtype:"hiddenfield",name:"bid",value:0}]});Ext.applyIf(a,{layout:{type:"border"},items:[b],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"保存",tooltip:"保存楼宇信息",iconCls:"ok",handler:function(){var c=a.down("form").getForm();if(c.isValid()){c.submit({url:"updateBuilding",success:function(d,e){Ext.Msg.alert("Success",e.result.msg);a.close()},failure:function(d,e){Ext.Msg.alert("Failed",e.result.msg)}})}}},{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){a.close()}}]}]});a.callParent(arguments);a.on("beforerender",a.on_beforerender)},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.EditPostionWindow",{extend:"Ext.window.Window",width:500,height:300,modal:true,rec:null,bid:0,title:"点位信息编辑",initComponent:function(){var a=this;var b=Ext.create("Ext.form.Panel",{region:"center",bodyPadding:5,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaultType:"textfield",items:[{fieldLabel:"点位代码",name:"pcode",anchor:"50%",allowBlank:false},{fieldLabel:"名称",name:"pname",allowBlank:false,maxLength:15,anchor:"50%"},{xtype:"fieldcontainer",fieldLabel:"任务",hidden:true,defaultType:"checkboxfield",items:[{boxLabel:"定点场强测试",name:"task",inputValue:"A",id:"task_checkbox1"},{boxLabel:"业务拨测",name:"task",inputValue:"B",checked:true,id:"task_checkbox2"},{boxLabel:"室内外切换测试",name:"task",inputValue:"C",id:"task_checkbox3"},{boxLabel:"CQT测试",name:"task",inputValue:"D",id:"task_checkbox4"}]},{fieldLabel:"备注",name:"remarks",allowBlank:false,maxLength:100,anchor:"50%"},{xtype:"hiddenfield",name:"bid",value:a.bid},{xtype:"hiddenfield",name:"pid",value:0}]});Ext.applyIf(a,{layout:"border",items:[b],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"保存",tooltip:"保存点位信息",iconCls:"ok",handler:function(){var c=a.down("form").getForm();if(c.isValid()){c.submit({url:"updatePostion",success:function(d,e){Ext.Msg.alert("Success",e.result.msg);a.close()},failure:function(d,e){Ext.Msg.alert("Failed",e.result.msg)}})}}},{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){a.close()}}]}]});a.callParent(arguments);a.on("beforerender",a.on_beforerender)},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.EditTaskWindow",{extend:"Ext.window.Window",width:600,height:400,modal:true,rec:null,title:"任务编辑",initComponent:function(){var a=this;var b=Ext.create("Ext.form.Panel",{region:"center",bodyPadding:5,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaults:{anchor:"95%"},defaultType:"textfield",items:[{fieldLabel:"任务号",name:"task_code",anchor:"50%",allowBlank:false},{fieldLabel:"任务类型",name:"task_type",allowBlank:false,xtype:"combobox",store:Ext.create("PT.store.TaskType"),queryMode:"local",displayField:"name",valueField:"value",anchor:"50%"},{fieldLabel:"楼宇点位",name:"locationCode",maxLength:20,allowBlank:false,anchor:"90%"},{xtype:"fieldcontainer",fieldLabel:"呼叫类型",defaultType:"radiofield",defaults:{flex:1},layout:"hbox",anchor:"100%",items:[{boxLabel:"主叫",name:"callType",inputValue:"CL0",checked:true,id:"callType_radio1"},{boxLabel:"被叫",name:"callType",inputValue:"CL1",id:"callType_radio2"}]},{fieldLabel:"主叫/被叫号码",name:"callTel",maxLength:15,allowBlank:false,anchor:"90%"},{fieldLabel:"通话持续时间",name:"callTime",xtype:"numberfield",minValue:0,value:10,allowBlank:false,anchor:"90%"},{fieldLabel:"呼叫超时",name:"timeout",xtype:"numberfield",minValue:0,value:10,allowBlank:false,anchor:"90%"},{fieldLabel:"次数",xtype:"textfield",name:"testTimes",xtype:"numberfield",minValue:0,value:10,anchor:"50%"},{fieldLabel:"测试员",xtype:"textfield",name:"testUser",maxLength:15,allowBlank:false,anchor:"50%"}]});Ext.applyIf(a,{layout:"border",items:[b],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"保存",tooltip:"保存添加测试任务",iconCls:"ok",handler:function(){var c=a.down("form").getForm();if(c.isValid()){c.submit({url:"submitTask",success:function(d,e){Ext.Msg.alert("Success",e.result.msg);a.close()},failure:function(d,e){Ext.Msg.alert("Failed",e.result.msg)}})}}},{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){a.close()}}]}]});a.callParent(arguments);a.on("beforerender",a.on_beforerender)},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.EditTestUserWindow",{extend:"Ext.window.Window",width:500,height:300,modal:true,rec:null,title:"巡检人员编辑",initComponent:function(){var a=this;var b=Ext.create("Ext.form.Panel",{region:"center",bodyPadding:5,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaultType:"textfield",items:[{fieldLabel:"手机号码",name:"mobileId",anchor:"70%",allowBlank:false},{fieldLabel:"姓名",name:"ename",allowBlank:false,maxLength:15,anchor:"70%"},{fieldLabel:"员工编码",name:"ecode",allowBlank:false,allowBlank:false,maxLength:15,anchor:"70%"}]});Ext.applyIf(a,{layout:"border",items:[b],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"保存",tooltip:"保存用户信息",iconCls:"ok",handler:function(){var c=a.down("form").getForm();if(c.isValid()){c.submit({url:"updateMobile",success:function(d,e){Ext.Msg.alert("Success",e.result.msg);a.close()},failure:function(d,e){Ext.Msg.alert("Failed",e.result.msg)}})}}},{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){a.close()}}]}]});a.callParent(arguments);a.on("beforerender",a.on_beforerender)},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.TaskUserSelWindow",{extend:"Ext.window.Window",width:600,height:500,modal:true,bid:null,title:"测试人员安排",initComponent:function(){var b=this;var c=Ext.create("Ext.data.Store",{fields:[{name:"mobileId",type:"int"},"ecode","ename",{name:"status",type:"int"}],proxy:{type:"ajax",url:"getTestUserList",reader:{type:"json",root:"rows"}}});var a=Ext.create("Ext.grid.Panel",{store:c,region:"center",selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"SIMPLE"}),columns:[{header:"手机号码",dataIndex:"mobileId"},{header:"员工编码",dataIndex:"ecode"},{header:"姓名",dataIndex:"ename",flex:1},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/delete.gif",tooltip:"删除",handler:function(e,g,d){var f=e.getStore().getAt(g);Ext.Msg.show({title:"信息",msg:"确定要删除测试人员吗？",buttons:Ext.Msg.YESNO,fn:function(i,j,h){if(i=="yes"){Ext.Ajax.request({url:"delTestUser",params:{bid:b.rec.data.bid,mobile:f.data.mobileId},success:function(l){var n=l.responseText;var k=Ext.JSON.decode(n);if(k.success){c.load({params:{bid:b.bid}})}else{alert(k.msg)}}})}},icon:Ext.window.MessageBox.QUESTION})}}]}],height:220,width:590});Ext.applyIf(b,{layout:{type:"border"},items:[a],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"添加",tooltip:"添加测试人员",iconCls:"add",handler:function(){Ext.create("PT.view.window.TaskUserWindow",{bid:b.bid,listeners:{beforedestroy:function(){c.load({params:{bid:b.bid}})}}}).show()}},"-",{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){b.close()}}]}]});b.callParent(arguments);c.load({params:{bid:b.bid}})},on_beforerender:function(c,a){var d=c.bid;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.EditUserWindow",{extend:"Ext.window.Window",width:600,height:400,modal:true,rec:null,title:"用户信息编辑",initComponent:function(){var a=this;var b=Ext.create("Ext.form.Panel",{region:"center",bodyPadding:5,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaultType:"textfield",items:[{fieldLabel:"用户名",name:"userName",anchor:"50%",allowBlank:false},{fieldLabel:"密码",name:"passWord",allowBlank:false,maxLength:15,blankText:"密码不能为空",inputType:"password",anchor:"50%"},{fieldLabel:"角色",name:"role",allowBlank:false,xtype:"combobox",store:Ext.create("PT.store.RoleType"),queryMode:"local",displayField:"name",valueField:"value",anchor:"50%"},{fieldLabel:"备注",xtype:"textareafield",name:"remarks",anchor:"50%"}]});Ext.applyIf(a,{layout:"border",items:[b],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"保存",tooltip:"保存用户信息",iconCls:"ok",handler:function(){var c=a.down("form").getForm();if(c.isValid()){c.submit({url:"submitUser",success:function(d,e){Ext.Msg.alert("Success",e.result.msg);a.close()},failure:function(d,e){Ext.Msg.alert("Failed",e.result.msg)}})}}},{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){a.close()}}]}]});a.callParent(arguments);a.on("beforerender",a.on_beforerender)},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.PostionListWindow",{extend:"Ext.window.Window",width:600,height:500,modal:true,rec:null,title:"点位信息查看",initComponent:function(){var b=this;var c=Ext.create("Ext.data.Store",{fields:[{name:"bid",type:"int"},"pcode","pname","task",{name:"pid",type:"int"},"remarks"],proxy:{type:"ajax",url:"getPostionBy",reader:{type:"json",root:"rows"}}});var a=Ext.create("Ext.grid.Panel",{region:"center",store:c,columns:[{header:"代码",dataIndex:"pcode",flex:1},{header:"名称",dataIndex:"pname",flex:2},{header:"任务",dataIndex:"task",hidden:true},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/information.png",tooltip:"修改",handler:function(e,g,d){var f=e.getStore().getAt(g);Ext.create("PT.view.window.EditPostionWindow",{rec:f,bid:b.rec.data.bid,listeners:{beforedestroy:function(){c.load({params:{bid:b.rec.data.bid}})}}}).show()}},{icon:"resources/images/icons/fam/delete.gif",tooltip:"删除",handler:function(e,g,d){var f=e.getStore().getAt(g);Ext.Msg.show({title:"信息",msg:"确定要删除选中点位信息吗？",buttons:Ext.Msg.YESNO,fn:function(i,j,h){if(i=="yes"){Ext.Ajax.request({url:"delPostion",params:{pid:f.data.pid},success:function(l){var n=l.responseText;var k=Ext.JSON.decode(n);if(k.success){c.load({params:{bid:b.rec.data.bid}})}else{alert(k.msg)}}})}},icon:Ext.window.MessageBox.QUESTION})}}]}]});Ext.applyIf(b,{layout:{type:"border"},items:[a],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"添加",tooltip:"添加点位",iconCls:"add",handler:function(){Ext.create("PT.view.window.EditPostionWindow",{rec:null,bid:b.rec.data.bid,listeners:{beforedestroy:function(){c.load({params:{bid:b.rec.data.bid}})}}}).show()}},"-",{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){b.close()}}]}]});b.callParent(arguments);c.load({params:{bid:b.rec.data.bid}})},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.EditPostionTaskWindow",{extend:"Ext.window.Window",width:500,height:300,modal:true,rec:null,bid:0,title:"点位任务编辑",initComponent:function(){var a=this;var b=function(d){if(a.rec.data.task.indexOf(d)==-1){return false}return true};var c=Ext.create("Ext.form.Panel",{region:"center",bodyPadding:5,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaultType:"textfield",items:[{fieldLabel:"点位代码",name:"pcode",anchor:"50%",hidden:true,allowBlank:false},{fieldLabel:"名称",name:"pname",allowBlank:false,maxLength:15,hidden:true,anchor:"50%"},{xtype:"fieldcontainer",fieldLabel:"任务",defaultType:"checkboxfield",items:[{boxLabel:"定点场强测试",name:"task",inputValue:"A",checked:b("A"),id:"task_checkbox1"},{boxLabel:"业务拨测",name:"task",inputValue:"B",checked:b("B"),id:"task_checkbox2"},{boxLabel:"室内外切换测试",name:"task",inputValue:"C",checked:b("C"),id:"task_checkbox3"},{boxLabel:"CQT测试",name:"task",inputValue:"D",checked:b("D"),id:"task_checkbox4"}]},{fieldLabel:"备注",name:"remarks",hidden:true,allowBlank:false,maxLength:100,anchor:"50%"},{xtype:"hiddenfield",name:"bid",value:a.bid},{xtype:"hiddenfield",name:"pid",value:0}]});Ext.applyIf(a,{layout:"border",items:[c],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"保存",tooltip:"保存点位信息",iconCls:"ok",handler:function(){var d=a.down("form").getForm();if(d.isValid()){d.submit({url:"updatePostion",success:function(e,f){Ext.Msg.alert("Success",f.result.msg);a.close()},failure:function(e,f){Ext.Msg.alert("Failed",f.result.msg)}})}}},{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){a.close()}}]}]});a.callParent(arguments);a.on("afterrender",a.on_beforerender)},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.TaskListWindow",{extend:"Ext.window.Window",width:600,height:500,modal:true,rec:null,title:"任务信息查看",initComponent:function(){var b=this;var c=Ext.create("Ext.data.Store",{fields:[{name:"bid",type:"int"},"pcode","pname","task",{name:"pid",type:"int"},"remarks"],proxy:{type:"ajax",url:"getPostionBy",reader:{type:"json",root:"rows"}}});var a=Ext.create("Ext.grid.Panel",{region:"center",store:c,columns:[{header:"代码",dataIndex:"pcode",hidden:true},{header:"名称",dataIndex:"pname",hidden:true},{header:"任务",dataIndex:"task",flex:1,renderer:function(d){var g="";var f=d.split(",");for(var e=0;e<f.length;e++){if(f[e]=="A"){g+="定点场强测试 "}else{if(f[e]=="B"){g+="业务拨测 "}else{if(f[e]=="C"){g+="室内外切换测试 "}else{if(f[e]=="D"){g+="CQT测试 "}}}}}return g}},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/information.png",tooltip:"修改",handler:function(e,g,d){var f=e.getStore().getAt(g);Ext.create("PT.view.window.EditPostionTaskWindow",{rec:f,bid:b.rec.data.bid,listeners:{beforedestroy:function(){c.load({params:{bid:b.rec.data.bid}})}}}).show()}}]}]});Ext.applyIf(b,{layout:{type:"border"},items:[a],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){b.close()}}]}]});b.callParent(arguments);c.load({params:{bid:b.rec.data.bid}})},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.TaskUserWindow",{extend:"Ext.window.Window",width:500,height:300,modal:true,bid:null,title:"添加测试人员",initComponent:function(){var b=this;var c=Ext.create("Ext.data.Store",{fields:[{name:"mobileId",type:"int"},"ecode","ename",{name:"status",type:"int"}],proxy:{type:"ajax",url:"getMobileList",reader:{type:"json",root:"rows"}}});var a=Ext.create("Ext.grid.Panel",{store:c,region:"center",selModel:Ext.create("Ext.selection.CheckboxModel",{mode:"SIMPLE"}),columns:[{header:"手机号码",dataIndex:"mobileId"},{header:"员工编码",dataIndex:"ecode"},{header:"姓名",dataIndex:"ename",flex:1}],height:220,width:590});Ext.applyIf(b,{layout:{type:"border"},items:[a],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"添加",tooltip:"添加测试人员",iconCls:"add",handler:function(){var d=b.child("grid").getSelectionModel().getSelection();if(d.length==0){alert("请选择要添加人员！");return}var e="";for(var f=0;f<d.length;f++){e+=d[f].data.mobileId+","}Ext.Ajax.request({url:"addTestUser",params:{mobiles:e,bid:b.bid},success:function(h){var i=h.responseText;var g=Ext.JSON.decode(i);if(g.success){b.close()}else{alert(g.msg)}}})}},"-",{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){b.close()}}]}]});b.callParent(arguments);c.load({params:{status:b.bid}})},on_beforerender:function(c,a){var d=c.bid;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.ViewBuildingWindow",{extend:"Ext.window.Window",width:600,height:500,modal:true,rec:null,title:"楼宇信息查看",initComponent:function(){var b=this;var d=Ext.create("Ext.form.Panel",{region:"center",bodyPadding:5,width:590,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaults:{anchor:"95%"},defaultType:"textfield",items:[{fieldLabel:"楼宇代码",name:"bcode",anchor:"50%",allowBlank:false},{fieldLabel:"名称",name:"bname",maxLength:20,allowBlank:false,anchor:"90%"},{fieldLabel:"行政区",name:"acode",allowBlank:false,xtype:"combobox",store:Ext.create("PT.store.TaskType"),queryMode:"local",displayField:"name",valueField:"value",anchor:"50%"},{fieldLabel:"地址",name:"blocation",maxLength:50,allowBlank:false,anchor:"90%"},{fieldLabel:"楼宇类型",xtype:"fieldcontainer",defaultType:"radiofield",defaults:{flex:1},layout:"hbox",anchor:"100%",items:[{boxLabel:"普通楼宇",name:"btype",inputValue:"0",checked:true,id:"btype_radio1"},{boxLabel:"VIP",name:"btype",inputValue:"1",id:"btype_radio2"},{boxLabel:"WIP",name:"btype",inputValue:"2",id:"btype_radio3"}]},{xtype:"textfield",fieldLabel:"经度",name:"longitude",anchor:"50%"},{fieldLabel:"纬度",xtype:"textfield",name:"latitude",anchor:"50%"},{fieldLabel:"备注",xtype:"textfield",name:"remarks",maxLength:255,allowBlank:true,anchor:"90%"},{xtype:"hiddenfield",name:"bid"}]});var c=Ext.create("Ext.data.Store",{fields:[{name:"bid",type:"int"},"pcode","pname","task",{name:"pid",type:"int"},"remarks"],proxy:{type:"ajax",url:"getPostionBy",reader:{type:"json",root:"rows"}}});var a=Ext.create("Ext.grid.Panel",{title:"点位信息",store:c,columns:[{header:"代码",dataIndex:"pcode"},{header:"名称",dataIndex:"pname"},{header:"任务",dataIndex:"task",flex:1},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/information.png",tooltip:"修改",handler:function(f,h,e){var g=f.getStore().getAt(h);Ext.create("PT.view.window.EditPostionWindow",{rec:g,listeners:{beforedestroy:function(){c.load({params:{bid:b.rec.data.bid}})}}}).show()}},{icon:"resources/images/icons/fam/delete.gif",tooltip:"删除",handler:function(f,h,e){var g=f.getStore().getAt(h)}}]}],height:220,width:590});Ext.applyIf(b,{layout:{type:"vbox"},items:[d,a],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){b.close()}}]}]});b.callParent(arguments);b.on("beforerender",b.on_beforerender);c.load({params:{bid:b.rec.data.bid}})},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});Ext.define("PT.view.window.ViewBuildingWindow2",{extend:"Ext.window.Window",maximizable:true,width:700,height:440,modal:true,rec:null,title:"楼宇信息查看",initComponent:function(){var c=this;var f=Ext.create("Ext.form.Panel",{region:"north",bodyPadding:5,width:590,layout:"anchor",fieldDefaults:{labelAlign:"right"},defaults:{anchor:"95%"},defaultType:"textfield",items:[{fieldLabel:"楼宇代码",name:"bcode",anchor:"50%",allowBlank:false},{fieldLabel:"名称",name:"bname",maxLength:20,allowBlank:false,anchor:"90%"},{fieldLabel:"行政区",name:"acode",allowBlank:false,xtype:"combobox",store:Ext.create("PT.store.TaskType"),queryMode:"local",displayField:"name",valueField:"value",anchor:"50%"},{fieldLabel:"地址",name:"blocation",maxLength:50,allowBlank:false,anchor:"90%"},{fieldLabel:"楼宇类型",xtype:"fieldcontainer",defaultType:"radiofield",defaults:{flex:1},layout:"hbox",anchor:"100%",items:[{boxLabel:"普通楼宇",name:"btype",inputValue:"0",checked:true,id:"btype_radio1"},{boxLabel:"VIP",name:"btype",inputValue:"1",id:"btype_radio2"},{boxLabel:"WIP",name:"btype",inputValue:"2",id:"btype_radio3"}]},,{fieldLabel:"备注",xtype:"textfield",name:"remarks",maxLength:255,allowBlank:true,anchor:"90%"},{xtype:"hiddenfield",name:"bid"}]});var e=Ext.create("Ext.data.Store",{fields:[{name:"bid",type:"int"},"pcode","pname","task",{name:"pid",type:"int"},"remarks"],proxy:{type:"ajax",url:"getPostionBy",reader:{type:"json",root:"rows"}}});var a=Ext.create("Ext.grid.Panel",{title:"点位信息",store:e,columns:[{header:"代码",dataIndex:"pcode"},{header:"名称",dataIndex:"pname"},{header:"任务",dataIndex:"task",flex:1},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/information.png",tooltip:"修改",handler:function(h,j,g){var i=h.getStore().getAt(j);Ext.create("PT.view.window.EditPostionWindow",{rec:i,listeners:{beforedestroy:function(){e.load({params:{bid:c.rec.data.bid}})}}}).show()}},{icon:"resources/images/icons/fam/delete.gif",tooltip:"删除",handler:function(h,j,g){var i=h.getStore().getAt(j);Ext.Msg.show({title:"信息",msg:"确定要删除点位信息吗？",buttons:Ext.Msg.YESNO,fn:function(l,m,k){if(l=="yes"){Ext.Ajax.request({url:"delPostion",params:{bid:i.data.bid,bid:c.rec.data.bid},success:function(o){var p=o.responseText;var n=Ext.JSON.decode(p);if(n.success){e.load({params:{bid:c.rec.data.bid}})}else{alert(n.msg)}}})}},icon:Ext.window.MessageBox.QUESTION})}}]}],height:200,width:350});var d=Ext.create("Ext.data.Store",{fields:[{name:"mobileId",type:"int"},"ecode","ename",{name:"status",type:"int"}],proxy:{type:"ajax",url:"getTestUserList",reader:{type:"json",root:"rows"}}});var b=Ext.create("Ext.grid.Panel",{title:"测试人员",store:d,columns:[{header:"手机号码",dataIndex:"mobileId"},{header:"员工编码",dataIndex:"ecode"},{header:"姓名",dataIndex:"ename",flex:1},{xtype:"actioncolumn",flex:1,items:[{icon:"resources/images/icons/fam/delete.gif",tooltip:"删除",handler:function(h,j,g){var i=h.getStore().getAt(j);Ext.Msg.show({title:"信息",msg:"确定要删除测试人员吗？",buttons:Ext.Msg.YESNO,fn:function(l,m,k){if(l=="yes"){Ext.Ajax.request({url:"delTestUser",params:{bid:c.rec.data.bid,mobileId:i.data.mobileId},success:function(o){var p=o.responseText;var n=Ext.JSON.decode(p);if(n.success){d.load({params:{bid:c.rec.data.bid}})}else{alert(n.msg)}}})}},icon:Ext.window.MessageBox.QUESTION})}}]}],height:200,width:350});Ext.applyIf(c,{layout:{type:"border"},items:[f,{region:"center",layout:"hbox",items:[a,b]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{text:"关闭",tooltip:"关闭窗口",iconCls:"cross",handler:function(){c.close()}}]}]});c.callParent(arguments);c.on("beforerender",c.on_beforerender);e.load({params:{bid:c.rec.data.bid}});d.load({params:{bid:c.rec.data.bid}})},on_beforerender:function(c,a){var d=c.rec;if(d!=null){var b=c.child("form").getForm();b.loadRecord(d)}}});